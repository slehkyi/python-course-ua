[Зміст](../Contents.md) \| [Попередній розділ (2.4. Послідовності)](04_Sequences.md) \| [Наступний розділ (2.6. Компрехенції списків)](06_List_comprehension.md)

# 2.5 Модуль колекцій
Модуль `collections` надає ряд корисних об'єктів для обробки даних. Ця частина коротко представляє деякі з функцій цього модуля.

### Приклад: Підрахунок елементів

Припустімо, ви хочете звести в таблицю загальну кількість акцій кожної акції.

```python
portfolio = [
    ('GOOG', 100, 490.1),
    ('IBM', 50, 91.1),
    ('CAT', 150, 83.44),
    ('IBM', 100, 45.23),
    ('GOOG', 75, 572.45),
    ('AA', 50, 23.15)
]
```

У цьому списку є два записи `IBM` і два `GOOG`. Акції потрібно якось об’єднати.

### Лічильники

Рішення: використовуйте `Лічильник`.
```python
from collections import Counter
total_shares = Counter()
for name, shares, price in portfolio:
    total_shares[name] += shares

total_shares['IBM']     # 150
```

### Приклад: Зіставлення один-до-багатьох

Проблема: ви хочете зіставити ключ із кількома значеннями.

```python
portfolio = [
    ('GOOG', 100, 490.1),
    ('IBM', 50, 91.1),
    ('CAT', 150, 83.44),
    ('IBM', 100, 45.23),
    ('GOOG', 75, 572.45),
    ('AA', 50, 23.15)
]
```

Як і в попередньому прикладі, замість ключа `IBM` має бути два різних тапли.

Рішення: використовуйте `defaultdict`.

```python
from collections import defaultdict
holdings = defaultdict(list)
for name, shares, price in portfolio:
    holdings[name].append((shares, price))
holdings['IBM'] # [ (50, 91.1), (100, 45.23) ]
```

`defaultdict` гарантує, що кожен раз, коли ви отримуєте доступ до ключа, ви отримуєте значення за замовчуванням.

### Приклад: Ведення історії

Проблема: нам потрібна історія останніх N елементів.
Рішення: використовуйте `deque`.
```python
from collections import deque

history = deque(maxlen=N)
with open(filename) as f:
    for line in f:
        history.append(line)
        ...
```

## Вправи

Модуль `collections` може бути одним із найкорисніших бібліотечних модулів для роботи зі спеціальними типами проблем обробки даних, таких як табулювання та індексування.

У цій вправі ми розглянемо кілька простих прикладів. Почніть із запуску програми `report.py`, щоб у вас був завантажений портфель акцій в інтерактивному режимі.
```bash
bash % python3 -i report.py
```

### Вправа 2.18: Табулювання за допомогою лічильників

Припустімо, ви хочете звести в таблицю загальну кількість акцій кожної акції. Це легко зробити за допомогою об’єкта `Counter`. Спробуйте наступне:
```python
>>> portfolio = read_portfolio('Data/portfolio.csv')
>>> from collections import Counter
>>> holdings = Counter()
>>> for s in portfolio:
        holdings[s['name']] += s['shares']

>>> holdings
Counter({'MSFT': 250, 'IBM': 150, 'CAT': 150, 'AA': 100, 'GE': 95})
>>>
```

Уважно спостерігайте, як кілька записів для `MSFT` та `IBM` у `portfolio` об'єднуються в один запис тут.

Ви можете використовувати лічильник так само, як словник, щоб отримати окремі значення:
```python
>>> holdings['IBM']
150
>>> holdings['MSFT']
250
>>>
```

Якщо ви хочете ранжувати значення:
```python
>>> # Отримати топ 3 акцій за кількістю
>>> holdings.most_common(3)
[('MSFT', 250), ('IBM', 150), ('CAT', 150)]
>>>
```

Давайте візьмемо інший портфель акцій і створимо новий лічильник:
```python
>>> portfolio2 = read_portfolio('Data/portfolio2.csv')
>>> holdings2 = Counter()
>>> for s in portfolio2:
          holdings2[s['name']] += s['shares']

>>> holdings2
Counter({'HPQ': 250, 'GE': 125, 'AA': 50, 'MSFT': 25})
>>>
```

Нарешті, давайте об’єднаємо всі `holdings`, виконавши одну просту операцію:

```python
>>> holdings
Counter({'MSFT': 250, 'IBM': 150, 'CAT': 150, 'AA': 100, 'GE': 95})
>>> holdings2
Counter({'HPQ': 250, 'GE': 125, 'AA': 50, 'MSFT': 25})
>>> combined = holdings + holdings2
>>> combined
Counter({'MSFT': 275, 'HPQ': 250, 'GE': 220, 'AA': 150, 'IBM': 150, 'CAT': 150})
>>>
```

Це лише мала частина того, що пропонують лічильники. Однак, якщо вам колись знадобиться звести значення в таблицю, вам слід розглянути можливість їх використання.

### Коментар: Модуль колекцій
Модуль `collections` є одним із найкорисніших бібліотечних модулів у всьому Python. Фактично, ми могли б зробити розширений розділ тільки про це. Однак зараз це лише відволікатиме. Наразі просто додайте `collections` до свого списку для читання перед сном.

[Зміст](../Contents.md) \| [Попередній розділ (2.4. Послідовності)](04_Sequences.md) \| [Наступний розділ (2.6. Компрехенції списків)](06_List_comprehension.md)
