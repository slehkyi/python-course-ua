[Зміст](../Contents.md) \| [Попередній розділ (2.2. Контейнери)](../02_Containers.md) \| [Наступний розділ (2.4. Послідовності)](../04_Sequences.md)

# 2.3 Форматування

Цей розділ є невеликим відступом, але коли ви працюєте з даними, вам часто потрібно буде створювати структурований вихід (таблиці тощо). Наприклад:
```code
      Name      Shares        Price
----------  ----------  -----------
        AA         100        32.20
       IBM          50        91.10
       CAT         150        83.44
      MSFT         200        51.23
        GE          95        40.37
      MSFT          50        65.10
       IBM         100        70.44
```
### Форматування рядків

Одним із способів форматування рядка в Python 3.6+ є використання `f-strings`.

```python
>>> name = 'IBM'
>>> shares = 100
>>> price = 91.1
>>> f'{name:>10s} {shares:>10d} {price:>10.2f}'
'       IBM        100      91.10'
>>>
```

Вираз `{expression:format}` просто замінюється.

Як правило вживається з `print`.

```python
print(f'{name:>10s} {shares:>10d} {price:>10.2f}')
```

### Коди формату

Коди формату (після `:` всередині `{}`) схожі на C `printf()`. Загальні коди включають:

```code
d       Десяткове ціле число
b       Двійкове ціле число
x       Шістнадцяткове ціле число
f       Число з плаваючою комою типу [-]m.dddddd
e       Число з плаваючою комою типу [-]m.dddddde+-xx
g       Число з плаваючою комою, але з вибірковим використанням нотації E 
s       Рядок
c       Символ (з цілого числа)
```

Загальні модифікатори регулюють ширину поля та десяткову точність. Неповний список:

```code
:>10d   Ціле число, вирівняне за правим краєм у полі з 10 символів
:<10d   Ціле число, вирівняне за лівим краєм у 10-символьному полі
:^10d   Ціле число з центром у полі з 10 символів
:0.2f   Плаваюче значення з точністю до 2 цифр
```

### Форматування словника

Ви можете використовувати метод `format_map()`, щоб застосувати форматування рядків до словника значень:

```python
>>> s = {
    'name': 'IBM',
    'shares': 100,
    'price': 91.1
}
>>> '{name:>10s} {shares:10d} {price:10.2f}'.format_map(s)
'       IBM        100      91.10'
>>>
```

Він використовує ті самі коди, що й `f-рядки`, але бере значення з наданого словника.

### метод format().

Існує метод `format()`, який може застосовувати форматування до аргументів або ключових аргументів.

```python
>>> '{name:>10s} {shares:10d} {price:10.2f}'.format(name='IBM', shares=100, price=91.1)
'       IBM        100      91.10'
>>> '{:10s} {:10d} {:10.2f}'.format('IBM', 100, 91.1)
'       IBM        100      91.10'
>>>
```

Чесно кажучи, `format()` трохи багатослівний. Я віддаю перевагу f-рядкам.

### Форматування в стилі C

Ви також можете використовувати оператор форматування `%`.

```python
>>> 'The value is %d' % 3
'The value is 3'
>>> '%5d %-5d %10d' % (3,4,5)
'    3 4              5'
>>> '%0.2f' % (3.1415926,)
'3.14'
```

Для нього потрібен один елемент або тапл праворуч. Коди форматів також моделюються за C-шним `printf()`.

*Примітка. Це єдине форматування, доступне для рядків байтів.*

```python
>>> b'%s has %d messages' % (b'Dave', 37)
b'Dave has 37 messages'
>>>
```

## Вправи

### Вправа 2.8: Як форматувати числа

Поширеною проблемою друку чисел є вказівка кількості знаків після коми. Один із способів виправити це - використовувати f-рядки. Спробуйте ці приклади:

```python
>>> value = 42863.1
>>> print(value)
42863.1
>>> print(f'{value:0.4f}')
42863.1000
>>> print(f'{value:>16.2f}')
        42863.10
>>> print(f'{value:<16.2f}')
42863.10
>>> print(f'{value:*>16,.2f}')
*******42,863.10
>>>
```

Повну документацію про коди форматування, що використовуються в f-рядках, можна знайти [тут](https://docs.python.org/3/library/string.html#format-specification-mini-language). Форматування також іноді виконується за допомогою оператора `%` рядків.

```python
>>> print('%0.4f' % value)
42863.1000
>>> print('%16.2f' % value)
        42863.10
>>>
```

Документацію щодо різних кодів, які використовуються з `%`, можна знайти [тут](https://docs.python.org/3/library/stdtypes.html#printf-style-string-formatting).

Хоча воно зазвичай використовується з `print`, форматування рядка не прив’язане до друку. Якщо ви хочете зберегти відформатований рядок. Просто призначте його змінній.

```python
>>> f = '%0.4f' % value
>>> f
'42863.1000'
>>>
```

### Вправа 2.9: Збір даних

У вправі 2.7 ви написали програму під назвою `report.py`, яка обчислювала прибуток/збиток портфеля акцій. У цій вправі ви почнете змінювати її, щоб отримати таку таблицю:

```
      Назва     Акції       Ціна      Зміна
---------- ---------- ---------- ----------
        AA        100       9.22     -22.98
       IBM         50     106.28      15.18
       CAT        150      35.46     -47.98
      MSFT        200      20.89     -30.34
        GE         95      13.48     -26.89
      MSFT         50      20.89     -44.21
       IBM        100     106.28      35.84
```

У цьому звіті «Ціна» — це поточна ціна акції, а «Зміна» — це зміна ціни акції порівняно з початковою ціною придбання.

Щоб створити наведений вище звіт, спочатку потрібно зібрати всі дані, наведені в таблиці. Напишіть функцію `make_report()`, яка приймає список акцій і словник цін як вхідні дані та повертає список таплів, що містять рядки наведеної вище таблиці.

Додайте цю функцію до свого файлу `report.py`. Ось як це має працювати, якщо ви спробуєте це в інтерактивному режимі:

```python
>>> portfolio = read_portfolio('Data/portfolio.csv')
>>> prices = read_prices('Data/prices.csv')
>>> report = make_report(portfolio, prices)
>>> for r in report:
        print(r)

('AA', 100, 9.22, -22.980000000000004)
('IBM', 50, 106.28, 15.180000000000007)
('CAT', 150, 35.46, -47.98)
('MSFT', 200, 20.89, -30.339999999999996)
('GE', 95, 13.48, -26.889999999999997)
...
>>>
```

### Вправа 2.10: Друк відформатованої таблиці

Повторіть цикл `for` у вправі 2.9, але змініть оператор print на форматування таплів.

```python
>>> for r in report:
        print('%10s %10d %10.2f %10.2f' % r)

          AA        100       9.22     -22.98
         IBM         50     106.28      15.18
         CAT        150      35.46     -47.98
        MSFT        200      20.89     -30.34
...
>>>
```

Ви також можете розширити значення та використовувати f-рядки. Наприклад:

```python
>>> for name, shares, price, change in report:
        print(f'{name:>10s} {shares:>10d} {price:>10.2f} {change:>10.2f}')

          AA        100       9.22     -22.98
         IBM         50     106.28      15.18
         CAT        150      35.46     -47.98
        MSFT        200      20.89     -30.34
...
>>>
```

Візьміть наведені вище твердження та додайте їх до своєї програми `report.py`. Нехай ваша програма візьме результат функції `make_report()` і надрукує гарно відформатовану таблицю, як показано.

### Вправа 2.11: Додавання деяких заголовків

Припустімо, що у вас є тапл із такими іменами заголовків:

```python
headers = ('Назва', 'Акції', 'Ціна', 'Зміна')
```

Додайте код до вашої програми, який бере наведений вище тапл заголовків і створює рядок, де кожне ім’я заголовка вирівнюється за правим краєм у полі шириною 10 символів, а кожне поле відокремлюється одним пробілом.

```python
'      Name     Shares      Price      Change'
```

Напишіть код, який приймає заголовки та створює рядок-роздільник між заголовками та даними, які слідують за ними. Цей рядок складається лише з набору символів «-» під назвою кожного поля. Наприклад:

```python
'---------- ---------- ---------- -----------'
```

Коли ви закінчите, ваша програма має створити таблицю, показану у верхній частині цієї вправи.

```
     Назва      Акції       Ціна      Зміна
---------- ---------- ---------- ----------
        AA        100       9.22     -22.98
       IBM         50     106.28      15.18
       CAT        150      35.46     -47.98
      MSFT        200      20.89     -30.34
        GE         95      13.48     -26.89
      MSFT         50      20.89     -44.21
       IBM        100     106.28      35.84
```

### Вправа 2.12: Форматування, задачка з зірочкою

Як би ви змінили свій код, щоб ціна включала символ валюти ($), а результат виглядав так:

```
      Name     Shares      Price     Change
---------- ---------- ---------- ----------
        AA        100      $9.22     -22.98
       IBM         50    $106.28      15.18
       CAT        150     $35.46     -47.98
      MSFT        200     $20.89     -30.34
        GE         95     $13.48     -26.89
      MSFT         50     $20.89     -44.21
       IBM        100    $106.28      35.84
```

[Зміст](../Contents.md) \| [Попередній розділ (2.2. Контейнери)](../02_Containers.md) \| [Наступний розділ (2.4. Послідовності)](../04_Sequences.md)
