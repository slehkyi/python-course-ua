[Зміст](../Contents.md) \| [Попередній розділ (2.1. Типи та структури даних)](01_Datatypes.md) \| [Наступний розділ (2.3. Форматування)](03_Formatting.md)

# 2.2 Контейнери

У цьому розділі розглядаються списки, словники та сети.

### Огляд

Програмам часто доводиться працювати з багатьма об'єктами.

* Портфель акцій
* Таблиця курсів акцій

Є три основні варіанти використання.

* Списки. Упорядковані дані.
* Словники. Невпорядковані дані.
* Набори. Невпорядкована колекція унікальних елементів.

### Списки як контейнер

Використовуйте список, коли порядок даних має значення. Пам’ятайте, що списки можуть містити будь-які об’єкти. Наприклад, список кортежів.

```python
portfolio = [
    ('GOOG', 100, 490.1),
    ('IBM', 50, 91.3),
    ('CAT', 150, 83.44)
]

portfolio[0]            # ('GOOG', 100, 490.1)
portfolio[2]            # ('CAT', 150, 83.44)
```

### Побудова списку

Створення списку з нуля.

```python
records = []  # Початковий порожній список

# Використовуйте .append(), щоб додати більше елементів
records.append(('GOOG', 100, 490.10))
records.append(('IBM', 50, 91.3))
...
```

Приклад під час читання записів з файлу.

```python
records = []  # Початковий порожній список

with open('Data/portfolio.csv', 'rt') as f:
    next(f) # Пропустити заголовок
    for line in f:
        row = line.split(',')
        records.append((row[0], int(row[1]), float(row[2])))
```

### Словник як контейнер

Словники корисні, якщо вам потрібен швидкий випадковий пошук (за назвою ключа). Наприклад, словник біржових цін:

```python
prices = {
   'GOOG': 513.25,
   'CAT': 87.22,
   'IBM': 93.37,
   'MSFT': 44.12
}
```

Ось кілька простих пошуків:

```python
>>> prices['IBM']
93.37
>>> prices['GOOG']
513.25
>>>
```

### DСтворення словників

Приклад створення словника з нуля.

```python
prices = {} # Початковий порожній словник

# Додати нові елементи
prices['GOOG'] = 513.25
prices['CAT'] = 87.22
prices['IBM'] = 93.37
```

Приклад заповнення словника із вмісту файлу.

```python
prices = {} # Початковий порожній словник

with open('Data/prices.csv', 'rt') as f:
    for line in f:
        row = line.split(',')
        prices[row[0]] = float(row[1])
```

Примітка: якщо ви спробуєте цю програму у файлі `Data/prices.csv`, ви побачите, що вона майже працює - у кінці є порожній рядок, який спричиняє збій. Вам потрібно буде знайти спосіб модифікації коду для врахування цього (див. вправу 2.6).

### Пошук у словнику

Ви можете перевірити наявність ключа.

```python
if key in d:
    # Так
else:
    # Ні
```

Ви можете знайти значення, яке може не існувати, і вказати значення за умовчанням, якщо його немає.

```python
name = d.get(key, default)
```

Приклад:

```python
>>> prices.get('IBM', 0.0)
93.37
>>> prices.get('SCOX', 0.0)
0.0
>>>
```

### Композитні ключі

Майже будь-який тип значення можна використовувати як ключ словника в Python. Ключ словника має бути незмінного типу. Наприклад, тапли:
```python
holidays = {
  (1, 1) : 'New Years',
  (3, 14) : 'Pi day',
  (9, 13) : "Programmer's day",
}
```

Потім для доступу:
```python
>>> holidays[3, 14]
'Pi day'
>>>
```

*Ні список, ні сет, ні інший словник не можуть служити ключем словника, оскільки списки та словники є змінними.*

### Сети

Сети - це колекція невпорядкованих унікальних елементів.
```python
tech_stocks = { 'IBM','AAPL','MSFT' }
# Альтернативний синтаксис
tech_stocks = set(['IBM', 'AAPL', 'MSFT'])
```

Сети корисні для тестів на членство.
```python
>>> tech_stocks
set(['AAPL', 'IBM', 'MSFT'])
>>> 'IBM' in tech_stocks
True
>>> 'FB' in tech_stocks
False
>>>
```

Сети також корисні для усунення дублікатів.
```python
names = ['IBM', 'AAPL', 'GOOG', 'IBM', 'GOOG', 'YHOO']

unique = set(names)
# unique = set(['IBM', 'AAPL','GOOG','YHOO'])
```

Додаткові операції з сетами:

```python
unique.add('CAT')        # Додати елемент
unique.remove('YHOO')    # Видалити елемент

s1 = { 'a', 'b', 'c'}
s2 = { 'c', 'd' }
s1 | s2                 # З'єднання сетів (Set union) { 'a', 'b', 'c', 'd' }
s1 & s2                 # Схрещення сетів (Set intersection) { 'c' }
s1 - s2                 # Різниця сетів (Set difference) { 'a', 'b' }
```

## Вправи

У цих вправах ви починаєте будувати одну з основних програм, які використовуватимуться протягом решти цього курсу. Виконайте свою роботу у файлі `Work/report.py`.

### Вправа 2.4: Список таплів

Файл `Data/portfolio.csv` містить список акцій у портфелі. У [вправі 1.30](../01_Introduction/07_Functions.md) ви написали функцію `portfolio_cost(filename)`, яка читала цей файл і виконувала просте обчислення.

Ваш код мав би виглядати приблизно так:

```python
# pcost.py

import csv

def portfolio_cost(filename):
    '''Computes the total cost (shares*price) of a portfolio file'''
    total_cost = 0.0

    with open(filename, 'rt') as f:
        rows = csv.reader(f)
        headers = next(rows)
        for row in rows:
            nshares = int(row[1])
            price = float(row[2])
            total_cost += nshares * price
    return total_cost
```

Використовуючи цей код як орієнтовний посібник, створіть новий файл `report.py`. У цьому файлі визначте функцію `read_portfolio(filename)`, яка відкриває вказаний файл портфоліо та зчитує його в список таплів. Для цього ви повинні внести кілька незначних змін у наведений вище код.

По-перше, замість того, щоб визначати `total_cost = 0`, ви створите змінну, яка спочатку має порожній список. Наприклад:

```python
portfolio = []
```

Далі, замість того, щоб підсумовувати вартість, ви перетворите кожен рядок на тапл, як ви щойно робили в попередній вправі, і додасте його до цього списку. Наприклад:

```python
for row in rows:
    holding = (row[0], int(row[1]), float(row[2]))
    portfolio.append(holding)
```

Нарешті, ви повернете отриманий список `portfolio`.

Експериментуйте зі своєю функцією в інтерактивному режимі (лише нагадування, що для цього вам спочатку потрібно запустити програму `report.py` в інтерпретаторі):

*Підказка: використовуйте `-i` під час виконання файлу в терміналі*
```python
>>> portfolio = read_portfolio('Data/portfolio.csv')
>>> portfolio
[('AA', 100, 32.2), ('IBM', 50, 91.1), ('CAT', 150, 83.44), ('MSFT', 200, 51.23),
    ('GE', 95, 40.37), ('MSFT', 50, 65.1), ('IBM', 100, 70.44)]
>>>
>>> portfolio[0]
('AA', 100, 32.2)
>>> portfolio[1]
('IBM', 50, 91.1)
>>> portfolio[1][1]
50
>>> total = 0.0
>>> for s in portfolio:
        total += s[1] * s[2]

>>> print(total)
44671.15
>>>
```

Цей список таплів, який ви створили, дуже схожий на двовимірний масив. Наприклад, ви можете отримати доступ до певного стовпця та рядка за допомогою пошуку, наприклад `portfolio[row][column]`, де `row` і `column` — цілі числа.

Тим не менш, ви також можете переписати останній цикл `for` за допомогою такого коду:
```python
>>> total = 0.0
>>> for name, shares, price in portfolio:
            total += shares*price

>>> print(total)
44671.15
>>>
```

### Вправа 2.5: Список словників

Візьміть функцію, яку ви написали у вправі 2.4, і змініть її, щоб представити кожну акцію в портфелі за допомогою словника замість таплу. У цьому словнику використовуйте назви полів `name`, `shares` і `price` для представлення різних стовпців у вхідному файлі.

Експериментуйте з цією новою функцією так само, як ви це робили у вправі 2.4.
```python
>>> portfolio = read_portfolio('Data/portfolio.csv')
>>> portfolio
[{'name': 'AA', 'shares': 100, 'price': 32.2}, {'name': 'IBM', 'shares': 50, 'price': 91.1},
    {'name': 'CAT', 'shares': 150, 'price': 83.44}, {'name': 'MSFT', 'shares': 200, 'price': 51.23},
    {'name': 'GE', 'shares': 95, 'price': 40.37}, {'name': 'MSFT', 'shares': 50, 'price': 65.1},
    {'name': 'IBM', 'shares': 100, 'price': 70.44}]
>>> portfolio[0]
{'name': 'AA', 'shares': 100, 'price': 32.2}
>>> portfolio[1]
{'name': 'IBM', 'shares': 50, 'price': 91.1}
>>> portfolio[1]['shares']
50
>>> total = 0.0
>>> for s in portfolio:
        total += s['shares']*s['price']

>>> print(total)
44671.15
>>>
```

Тут ви помітите, що доступ до різних полів для кожного запису здійснюється за назвами ключів замість числових номерів стовпців. Це часто є кращим і зручнішим способом, оскільки отриманий код легше читати пізніше.

Перегляд великих словників і списків може бути безладним. Щоб очистити вивід для налагодження та тестування, розгляньте можливість використання функції `pprint`.

```python
>>> from pprint import pprint
>>> pprint(portfolio)
[{'name': 'AA', 'price': 32.2, 'shares': 100},
    {'name': 'IBM', 'price': 91.1, 'shares': 50},
    {'name': 'CAT', 'price': 83.44, 'shares': 150},
    {'name': 'MSFT', 'price': 51.23, 'shares': 200},
    {'name': 'GE', 'price': 40.37, 'shares': 95},
    {'name': 'MSFT', 'price': 65.1, 'shares': 50},
    {'name': 'IBM', 'price': 70.44, 'shares': 100}]
>>>
```

### Вправа 2.6: Словники як контейнер

Словник — це корисний спосіб відстежувати елементи, коли ви хочете шукати елементи за допомогою індексу, відмінного від цілого числа. В оболонці Python спробуйте погратися зі словником:
```python
>>> prices = { }
>>> prices['IBM'] = 92.45
>>> prices['MSFT'] = 45.12
>>> prices
... look at the result ...
>>> prices['IBM']
92.45
>>> prices['AAPL']
... look at the result ...
>>> 'AAPL' in prices
False
>>>
```

Файл `Data/prices.csv` містить низку рядків із курсами акцій. Файл виглядає приблизно так:

```csv
"AA",9.22
"AXP",24.85
"BA",44.85
"BAC",11.27
"C",3.72
...
```

Напишіть функцію `read_prices(filename)`, яка зчитує такий набір цін у словник, де ключами словника є назви акцій, а значеннями в словнику є ціни акцій.

Для цього почніть із порожнього словника та почніть вставляти в нього значення, як ви це робили вище. Однак зараз ви читаєте значення з файлу.

Ми використовуватимемо цю структуру даних для швидкого пошуку ціни певної назви акцій.

Кілька маленьких порад, які вам знадобляться для цієї частини. По-перше, переконайтеся, що ви використовуєте модуль `csv` так само, як і раніше — тут не потрібно винаходити колесо.

```python
>>> import csv
>>> f = open('Data/prices.csv', 'r')
>>> rows = csv.reader(f)
>>> for row in rows:
        print(row)


['AA', '9.22']
['AXP', '24.85']
...
[]
>>>
```

Інша невелика складність полягає в тому, що файл `Data/prices.csv` може містити кілька порожніх рядків. Зверніть увагу, що останній рядок даних вище є порожнім списком, що означає, що в цьому рядку немає даних.

Існує ймовірність, що це може спричинити зупинку вашої програми за винятком. Використовуйте оператори `try` і `except`, щоб обробити такі випадки належним чином. На подумати: чи краще було б захищатися від неправильних даних за допомогою оператора `if`?

Написавши свою функцію `read_prices()`, перевірте її в інтерактивному режимі, щоб переконатися, що вона працює:

```python
>>> prices = read_prices('Data/prices.csv')
>>> prices['IBM']
106.28
>>> prices['MSFT']
20.89
>>>
```

### Вправа 2.7: Дізнайтеся, чи можете ви вийти на пенсію

Зв’яжіть усю цю роботу разом, додавши кілька додаткових операторів до вашої програми `report.py`, яка обчислює прибуток/збиток. Ці твердження мають взяти список акцій у вправі 2.5 і словник цін у вправі 2.6 і обчислити поточну вартість портфеля разом із прибутком/збитком.


[Зміст](../Contents.md) \| [Попередній розділ (2.1. Типи та структури даних)](01_Datatypes.md) \| [Наступний розділ (2.3. Форматування)](03_Formatting.md)
