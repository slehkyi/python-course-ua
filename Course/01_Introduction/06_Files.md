[Зміст](../Contents.md) \| [Попередній розділ (1.5. Списки)](05_Lists.md) \| [Наступний розділ (1.7. Функції)](07_Functions.md)

# 1.6 Управління файлами

Більшості програм потрібно звідкись читати дані. У цьому розділі обговорюється доступ до файлів.

### Введення та виведення файлів
Відкрити файл.
```python
f = open('foo.txt', 'rt')     # Відкрити для читання тексту
g = open('bar.txt', 'wt')     # Відкрити для писання (додавання) тексту
```

Зчитати всі дані.
```python
data = f.read()

# Прочитати тільки до 'maxbytes' байтів тексту
data = f.read([maxbytes])
```

Написати трохи тексту.
```python
g.write('some text')
```

Закрити файл по завершенню роботи.
```python
f.close()
g.close()
```

Файли завжди повинні бути належним чином закриті, а це крок, про який легко забути. Таким чином, кращим підходом є використання оператора `with`.
```python
with open(filename, 'rt') as file:
    # Використовувати файл `file`
    ...
    # Не треба закривати файл за допомогою окремої команди
...інші команди
```
Оператор `with` автоматично закриває файл, коли елемент керування залишає блок коду з відступом.

### Загальні ідіоми для читання даних файлів
Прочитати весь файл відразу як рядок.
```python
with open('foo.txt', 'rt') as file:
    data = file.read()
    # `data` is a string with all the text in `foo.txt`
```

Прочитати файл рядок за рядком шляхом ітерації.

```python
with open(filename, 'rt') as file:
    for line in file:
        # Зробити щось із рядком
```

### Загальні ідіоми для запису даних у файл

Записати рядкові (текстові) дані.
```python
with open('outfile', 'wt') as out:
    out.write('Hello World\n')
    ...
```

Перенаправити функцію друку.
```python
with open('outfile', 'wt') as out:
    print('Hello World', file=out)
    ...
```

## Вправи

Ці вправи залежать від файлу `Data/portfolio.csv`. Файл містить список рядків з інформацією про портфель акцій. Передбачається, що ви працюєте в каталозі `python-course-ua/Work/`. Якщо ви не впевнені, ви можете дізнатися, де Python думає, що він працює, роблячи наступне:
```python
>>> import os
>>> os.getcwd()
'/Users/beazley/Desktop/practical-python/Work' # Результат відрізнятиметься
>>>
```

### Вправа 1.26: Попередні приготування

Спочатку спробуйте прочитати весь файл відразу як великий рядок:
```python
>>> with open('Data/portfolio.csv', 'rt') as f:
        data = f.read()

>>> data
'name,shares,price\n"AA",100,32.20\n"IBM",50,91.10\n"CAT",150,83.44\n"MSFT",200,51.23\n"GE",95,40.37\n"MSFT",50,65.10\n"IBM",100,70.44\n'
>>> print(data)
name,shares,price
"AA",100,32.20
"IBM",50,91.10
"CAT",150,83.44
"MSFT",200,51.23
"GE",95,40.37
"MSFT",50,65.10
"IBM",100,70.44
>>>
```
У наведеному вище прикладі слід зазначити, що Python має два режими виводу. У першому режимі, де ви вводите `data` у підказці, Python показує необроблене представлення рядка, включаючи лапки та escape коди. Коли ви вводите `print(data)`, ви отримуєте фактичний формат вивиду рядка.

Хоча читання файлу одночасно є простим, часто це не найбільш підходящий спосіб це робити — особливо якщо файл випадково є величезним або якщо містить рядки тексту, які потрібно обробляти по одному.

Щоб прочитати файл рядок за рядком, використовуйте цикл `for`:
```python
>>> with open('Data/portfolio.csv', 'rt') as f:
        for line in f:
            print(line, end='')

name,shares,price
"AA",100,32.20
"IBM",50,91.10
...
>>>
```
Коли ви використовуєте код вище, рядки читаються до досягнення кінця файлу, на чому цикл зупиняється.

У деяких випадках ви можете вручну прочитати або пропустити а *один* рядок тексту (наприклад, ви хочете пропустити перший рядок заголовків стовпців).
```python
>>> f = open('Data/portfolio.csv', 'rt')
>>> headers = next(f)
>>> headers
'name,shares,price\n'
>>> for line in f:
    print(line, end='')

"AA",100,32.20
"IBM",50,91.10
...
>>> f.close()
>>>
```

`next()` повертає наступний рядок тексту у файлі. Якщо ви будете викликати його декілька разів, ви отримаєте послідовні рядки.
Однак, щоб ви знали, цикл `for` вже використовує `next()` для отримання своїх даних. Таким чином, ви зазвичай не викликаєте його безпосередньо, якщо ви не намагаєтеся явно пропустити або прочитати один рядок, як показано.

Після того, як ви прочитаєте рядки файлу, ви можете почати виконувати додаткову обробку, як-от розділення. Наприклад, спробуйте це:
```python
>>> f = open('Data/portfolio.csv', 'rt')
>>> headers = next(f).split(',')
>>> headers
['name', 'shares', 'price\n']
>>> for line in f:
    row = line.split(',')
    print(row)

['"AA"', '100', '32.20\n']
['"IBM"', '50', '91.10\n']
...
>>> f.close()
```

*Примітка. У цих прикладах `f.close()` викликається явно, оскільки оператор `with` не використовується.*

### Вправа 1.27: Читання файлу даних

Тепер, коли ви знаєте, як читати файл, давайте напишемо програму для виконання простих обчислень.

Стовпці в `portfolio.csv` відповідають назві акції, кількості акцій та ціна купівлі однієї акції. Напишіть програму під назвою `pcost.py`, який відкриває цей файл, читає всі рядки та обчислює, скільки коштує придбання всіх акцій у портфелі.

*Підказка: щоб перетворити рядок у ціле число, використовуйте `int(s)`. Щоб перетворити рядок у число з плаваючою комою, використовуйте `float(s)`.*

Ваша програма має надрукувати такі результати:
```bash
Total cost 44671.15
```

### Вправа 1.28: Інші види "файлів"

Що робити, якщо ви хочете прочитати нетекстовий файл, наприклад, стиснутий gzip файл даних? Вбудована функція `open()` тут вам не допоможе, але Python має бібліотечний модуль `gzip`, який може читати стиснені gzip-файли.

Спробуйте наступне:
```python
>>> import gzip
>>> with gzip.open('Data/portfolio.csv.gz', 'rt') as f:
    for line in f:
        print(line, end='')

... подивіться на вивід ...
>>>
```

Примітка. Тут важливо включити режим файлу `'rt'`. Якщо це провтикати, ви отримаєте рядки байтів замість звичайних текстових рядків.

### Коментар: Хіба ми не повинні використовувати Pandas для читання CSV файлів?

Дослідники даних швидко відзначають, що бібліотеки на кшталт [Pandas](https://pandas.pydata.org) уже мають функцію для читання файлів CSV. Це правда - і вона працює досить добре. Однак це не курс вивчення `pandas`. Читання файлів це більш загальна проблема, ніж читання файлів CSV. Основна причина, чому ми працюємо з файлом CSV, полягає в тому, що це формат знайомий більшості програмістів, і з ним відносно легко працювати безпосередньо, ілюструючи багато функцій Python в процесі. Тому обов’язково використовуйте Pandas, коли маєте змогу. Для решти цього курсу, однак, ми будемо дотримуватися стандартних функцій Python.

[Зміст](../Contents.md) \| [Попередній розділ (1.5. Списки)](05_Lists.md) \| [Наступний розділ (1.7. Функції)](07_Functions.md)
